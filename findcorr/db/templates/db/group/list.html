{% extends 'db/base.html' %}

{% block content %}
    <form method="GET" class="form-container">
        <div class="search-form">
            <input type="text" name="q" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ä—É" value="{{ request.GET.q }}">
            <input type="submit" value="üîç">
        </div>
        <div class="dropdown">
            <label for="industry">–û—Ç—Ä–∞—Å–ª—å:</label>
            <select id="industry" name="industry" onchange="this.form.submit()">
                <option value="">
                    {% if request.GET.industry %}
                        {{ request.GET.industry }}
                    {% else %}
                        –í—Å–µ
                    {% endif %}
                </option>
                {% for industry in industries %}
                    {% if forloop.first and request.GET.industry %}
                        <option value="">–í—Å–µ</option>
                    {% endif %}
                    <option value="{{ industry }}" {% if request.GET.industry == industry %}selected{% endif %}>{{ industry }}</option>
                {% endfor %}
            </select>
            <div class="ticker-count-info">–î–æ—Å—Ç—É–ø–Ω–æ: {{ correlations.paginator.count }}</div>
        </div>
    </form>
    <table>
        <tr>
            <th><a href="?sort=ticker_a&direction={% if request.GET.sort == 'ticker_a' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–¢–∏–∫–µ—Ä A</a></th>
            <th><a href="?sort=name_a&direction={% if request.GET.sort == 'name_a' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–ù–∞–∑–≤–∞–Ω–∏–µ A</a></th>
            <th><a href="?sort=sector_a&direction={% if request.GET.sort == 'sector_a' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–û—Ç—Ä–∞—Å–ª—å A</a></th>
            <th><a href="?sort=ticker_b&direction={% if request.GET.sort == 'ticker_b' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–¢–∏–∫–µ—Ä –ë</a></th>
            <th><a href="?sort=name_b&direction={% if request.GET.sort == 'name_b' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–ù–∞–∑–≤–∞–Ω–∏–µ –ë</a></th>
            <th><a href="?sort=sector_b&direction={% if request.GET.sort == 'sector_b' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–û—Ç—Ä–∞—Å–ª—å –ë</a></th>
            <th><a href="?sort=correlation&direction={% if request.GET.sort == 'correlation' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è</a></th>
            <th><a href="?sort=status&direction={% if request.GET.sort == 'status' and request.GET.direction == 'asc' %}desc{% else %}asc{% endif %}">–°—Ç–∞—Ç—É—Å</a></th>
        </tr>
        {% for group in correlations %}
        <tr>
            <td class="bold">
                <a href="{% url 'db:corr' ticker_a=group.ticker_a ticker_b=group.ticker_b %}">
                    {{ group.ticker_a }}
                </a>
            </td>
            <td>{{ group.name_a }}</td>
            <td>{{ group.sector_a }}</td>
            <td class="bold">
                <a href="{% url 'db:corr' ticker_a=group.ticker_a ticker_b=group.ticker_b %}">
                    {{ group.ticker_b }}
                </a>
            </td>
            <td>{{ group.name_b }}</td>
            <td>{{ group.sector_b }}</td>
            <td>{{ group.correlation }}</td>
            <td class="status {% if group.status == '–°–ª–∞–±–∞—è' %}weak{% elif group.status == '–°—Ä–µ–¥–Ω—è—è' %}medium{% elif group.status == '–°–∏–ª—å–Ω–∞—è' %}strong{% endif %}">{{ group.status }}</td>
        </tr>
        {% endfor %}
    </table>
    <div class="pagination">
        {% if correlations.has_previous %}
            <a class="pagination-button" href="?page={{ correlations.previous_page_number }}&industry={{ selected_industry }}">‚Üê</a>
        {% endif %}
    
        {% for i in correlations.paginator.page_range %}
            {% if correlations.number == i %}
                <a class="pagination-button current" href="?page={{ i }}&industry={{ selected_industry }}">{{ i }}</a>
            {% elif i > correlations.number|add:"-5" and i < correlations.number|add:"5" %}
                <a class="pagination-button" href="?page={{ i }}&industry={{ selected_industry }}">{{ i }}</a>
            {% elif i == 1 %}
                <a class="pagination-button" href="?page={{ i }}&industry={{ selected_industry }}">{{ i }}</a>
                {% if correlations.number > 6 %}
                    <span class="pagination-ellipsis">...</span>
                {% endif %}
            {% elif i == correlations.paginator.num_pages %}
                {% if correlations.number|add:"5" < correlations.paginator.num_pages %}
                    <span class="pagination-ellipsis">...</span>
                {% endif %}
                <a class="pagination-button" href="?page={{ i }}&industry={{ selected_industry }}">{{ i }}</a>
            {% endif %}
        {% endfor %}
    
        {% if correlations.has_next %}
        <a class="pagination-button" href="?page={{ correlations.next_page_number }}&industry={{ selected_industry }}">‚Üí</a>
        {% endif %}
    </div>
{% endblock %}